<migration urlid="http://www.microsoft.com/migration/1.0/migxmlext/offlineupgrade">
  <component type="System" context="System">
    <displayName>offlineUpgrade</displayName>
    <paths>
      <path type="File">%WINDIR%\offlineUpgrade</path>
    </paths>
    <role role="Settings">
      <rules>

        <excludeAttributes attributes="Security">
          <objectSet>
            <pattern type="File">* [*]</pattern>
            <pattern type="Registry">* [*]</pattern>
          </objectSet>
        </excludeAttributes>

        <include>
          <objectSet>
            <pattern type="File">%WINDIR%\Security [edb*.log]</pattern>
            <pattern type="File">%WINDIR%\Security [edb.chk]</pattern>
            <pattern type="File">%WINDIR%\Security\Database [secedit.sdb]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\MountedDevices [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters [HostName]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters [NV HostName]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters [Domain]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters [NV Domain]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\* [*]</pattern>

            <pattern type="Registry">HKLM\SYSTEM\Setup\Upgrade\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\NDIS\IfTypes\* [*]</pattern>

            <pattern type="Registry">HKLM\SYSTEM\WPA\8DEC0AF1-0341-4b93-85CD-72606C2DF94C$\* [*]</pattern>
            <pattern type="File">%WINDIR%\System32 [*.C7483456-A289-439d-8115-601632D005A0]</pattern>

            <pattern type="File">%WINDIR% [WindowsUpdate.log]</pattern>
            <pattern type="File">%WINDIR%\SoftwareDistribution\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\* [*]</pattern>

            <pattern type="File">%WINDIR%\System32\LogFiles\WMI\RtBackup* [*]</pattern>

          </objectSet>
        </include>
        <exclude>
          <objectSet>
            <pattern type="File">%WINDIR%\SoftwareDistribution\DataStore\* [*]</pattern>
            <pattern type="File">%WINDIR%\SoftwareDistribution\Download\* [*]</pattern>
            <pattern type="File">%WINDIR%\SoftwareDistribution\ScanFile\* [*]</pattern>
            <pattern type="File">%WINDIR%\SoftwareDistribution\SelfUpdate\* [*]</pattern>
            <pattern type="File">%WINDIR%\SoftwareDistribution\WebSetup\* [*]</pattern>
            <pattern type="File">%WINDIR%\SoftwareDistribution\WuRedir\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Setup\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [SetupWizardLaunchTime]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [FirstDetectionFailureTime]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [BalloonType]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [BalloonTime]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [ScheduledInstallDate]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [ShowUnableToDetectUI]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [OfflineDetectionPending]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [UnableToDetectTime]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [DownloadExpirationTime]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [NextDetectionTime]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update\Results\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [ResetAU]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update [SelfUpdateTime]</pattern>
          </objectSet>
        </exclude>

        <include>
          <objectSet>
            <pattern type="File">%WINDIR%\debug [sam.log]</pattern>

            <pattern type="Registry">HKLM\SECURITY\Policy\PolAcDmS []</pattern>

            <pattern type="File">%WINDIR%\system32\Microsoft\Protect\*[*]</pattern>
            <pattern type="File">%WINDIR%\system32\Microsoft\Protect\*\User[*]</pattern>

            <pattern type="Registry">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\* [*]</pattern>

          </objectSet>
        </include>
        <exclude>
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa [FIPSAlgorithmPolicy]</pattern>
          </objectSet>
        </exclude>

        <include>
          <objectSet>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\setup.exe [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Configuration Manager [RegDebugBreaksEnabled]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Cryptography[MachineGuid]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Cryptography\Defaults\Provider\*[*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Cryptography\Defaults\Provider Types\*[*]</pattern>
            <pattern type="File">%SYSTEM32%\Microsoft\Crypto\RSA\MachineKeys[*]</pattern>
            <pattern type="File">%SYSTEM32%\Microsoft\Crypto\DSS\MachineKeys[*]</pattern>
            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\RSA\*[*]</pattern>
            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\DSS\*[*]</pattern>
            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\SystemKeys\*[*]</pattern>

            @*: CNG system
            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\Keys[*]</pattern>
            <pattern type="File">%SYSTEMROOT%\ServiceProfiles\LocalService\AppData\Roaming\Microsoft\Crypto\Keys[*]</pattern>
            <pattern type="File">%SYSTEMROOT%\ServiceProfiles\NetworkService\AppData\Roaming\Microsoft\Crypto\Keys[*]</pattern>

          </objectSet>
        </include>
        <exclude>
          <objectSet>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\setup.exe [VerifierDlls]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\setup.exe [GlobalFlag]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\setup.exe [VerifierFlags]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\setup.exe [PageHeapFlags]</pattern>
          </objectSet>
        </exclude>

        <contentModify script="MigXmlHelper.MergeMultiSzContent('Add','tspkg','Add','pku2u')">
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa [Security Packages]</pattern>
          </objectSet>
        </contentModify>

        <merge script="MigXmlHelper.FindFilePlaceByPattern('&lt;F&gt; (&lt;N&gt;).&lt;E&gt;')">
              <objectSet>
            <pattern type="File">%WINDIR% [WindowsUpdate.log]</pattern>
              </objectSet>
        </merge>

        <merge script="MigXmlHelper.SourcePriority()">
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\WPA\8DEC0AF1-0341-4b93-85CD-72606C2DF94C$\* [*]</pattern>
            <pattern type="File">%WINDIR%\System32 [*.C7483456-A289-439d-8115-601632D005A0]</pattern>

            <pattern type="File">%WINDIR%\SoftwareDistribution\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\* [*]</pattern>

            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Cryptography[MachineGuid]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Cryptography\Defaults\Provider\*[*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Cryptography\Defaults\Provider Types\*[*]</pattern>
            <pattern type="File">%SYSTEM32%\Microsoft\Crypto\RSA\MachineKeys[*]</pattern>
            <pattern type="File">%SYSTEM32%\Microsoft\Crypto\DSS\MachineKeys[*]</pattern>
            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\RSA\MachineKeys[*]</pattern>
            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\DSS\MachineKeys[*]</pattern>

            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\Keys[*]</pattern>
            <pattern type="File">%SYSTEMROOT%\ServiceProfiles\LocalService\AppData\Roaming\Microsoft\Crypto\Keys[*]</pattern>
            <pattern type="File">%SYSTEMROOT%\ServiceProfiles\NetworkService\AppData\Roaming\Microsoft\Crypto\Keys[*]</pattern>

          </objectSet>
        </merge>

        <contentModify script="MigXmlHelper.KeepExisting('Security','FileAttrib:HSRI')">
          <objectSet>
            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\RSA\MachineKeys</pattern>
            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\DSS\MachineKeys</pattern>
          </objectSet>
        </contentModify>

        <include>
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation\* [*]</pattern>
          </objectSet>
        </include>

        <exclude>
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation [ActiveTimeBias]</pattern>
          </objectSet>
        </exclude>

        <destinationCleanup>
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation\* [*]</pattern>
          </objectSet>
        </destinationCleanup>

        <merge script="MigXmlHelper.SourcePriority()">
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation\* [*]</pattern>
          </objectSet>
        </merge>

        <includeAttributes attributes="Security">
          <objectSet>

            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Cryptography[MachineGuid]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Cryptography\Defaults\Provider\*[*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Cryptography\Defaults\Provider Types\*[*]</pattern>
            <pattern type="File">%SYSTEM32%\Microsoft\Crypto\RSA\MachineKeys[*]</pattern>
            <pattern type="File">%SYSTEM32%\Microsoft\Crypto\DSS\MachineKeys[*]</pattern>

            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\Keys[*]</pattern>
            <pattern type="File">%SYSTEMROOT%\ServiceProfiles\LocalService\AppData\Roaming\Microsoft\Crypto\Keys[*]</pattern>
            <pattern type="File">%SYSTEMROOT%\ServiceProfiles\NetworkService\AppData\Roaming\Microsoft\Crypto\Keys[*]</pattern>

            <pattern type="File">%WINDIR%\system32\Microsoft\Protect\Recovery[*]</pattern>
          </objectSet>
        </includeAttributes>

        <includeAttributes attributes="Security,CopyInheritedDaclEntries">
          <objectSet>
            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\RSA\MachineKeys[*]</pattern>
            <pattern type="File">%ALLUSERSAPPDATA%\Microsoft\Crypto\DSS\MachineKeys[*]</pattern>
          </objectSet>
        </includeAttributes>

        <locationModify script="MigXmlHelper.ExactMove('HKLM\System\Setup\SetupCl\PendingRequest [SidAccountDomainNew]')">
          <objectSet>
            <pattern type="Registry">HKLM\SECURITY\Policy\PolAcDmS []</pattern>
          </objectSet>
        </locationModify>


        <destinationCleanup>
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Audit\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Credssp\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Data\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\FipsAlgorithmPolicy\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\GBG\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\JD\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Skew1\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\SSO\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Lsa\SspiCache\* [*]</pattern>

            <pattern type="File">%WINDIR%\Security [edb*.log]</pattern>
            <pattern type="File">%WINDIR%\Security [edb.chk]</pattern>
            <pattern type="File">%WINDIR%\Security\Database [secedit.sdb]</pattern>

            <pattern type="File">%WINDIR%\debug [sam.log]</pattern>

            <pattern type="File">%WINDIR%\system32\Microsoft\Protect\*[*]</pattern>
            <pattern type="File">%WINDIR%\system32\Microsoft\Protect\*\User[*]</pattern>

            <pattern type="Registry">HKLM\SYSTEM\WPA\8DEC0AF1-0341-4b93-85CD-72606C2DF94C$\* [*]</pattern>
            <pattern type="File">%WINDIR%\System32 [*.C7483456-A289-439d-8115-601632D005A0]</pattern>

            <!-- NDIS staged upgrade cleanup -->
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Class\{4D36E972-E325-11CE-BFC1-08002bE10318}\$ [NetLuidIndex]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Class\{6BDD1FC5-810F-11D0-BEC7-08002BE2092F}\$ [NetLuidIndex]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Network\{4D36E972-E325-11CE-BFC1-08002bE10318}\{* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Nsi\{eb004a11-9b1a-11d4-9123-0050047759bc}\10\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Nsi\{eb004a11-9b1a-11d4-9123-0050047759bc}\7\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Control\Nsi\{eb004a11-9b1a-11d4-9123-0050047759bc}\6\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\NDIS\IfTypes\$ [IfType]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\NDIS\IfTypes\$ [IfUsedNetLuidIndices]</pattern>

          </objectSet>
        </destinationCleanup>

      </rules>

      <rules>
        <detects>
          <detect>
            <condition>MigXmlHelper.IsOSEarlierThan("NT","6.0.0.0")</condition>
          </detect>
        </detects>

        <include>
          <objectSet>
            <!-- Eventlog machine specific settings (owner:MichaelM)-->
            <pattern type="File">%WINDIR%\system32\config [*.evt]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\* [*]</pattern>
          </objectSet>
        </include>

	<exclude>
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\EventLog\Application\WinRM\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\EventLog\System\WinRM\* [*]</pattern>
          </objectSet>
    	</exclude>

        <includeAttributes attributes="Security">
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\ADAM*</pattern>
          </objectSet>
        </includeAttributes>

        <exclude>
          <objectSet>
            <!-- Event log path -->
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [File]</pattern>
          </objectSet>
        </exclude>

        <merge script="MigXmlHelper.DestinationPriority()">
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\* [*]</pattern>

            <!-- Svchost settings -->
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog [*]</pattern>
          </objectSet>
        </merge>

        <merge script="MigXmlHelper.SourcePriority()">
          <objectSet>
            <!-- Event log files -->
            <pattern type="File">%WINDIR%\system32\config [*.evt]</pattern>

            <!-- Classic event log settings -->
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [CustomSD]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [Isolation]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [Retention]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [AutoBackupLogFiles]</pattern>
          </objectSet>
        </merge>

        <merge script="MigXmlHelper.HigherValue()">
          <objectSet>
             <!-- Event log size -->
             <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [MaxSize]</pattern>
          </objectSet>
        </merge>
      </rules>

      <rules>
        <detects>
          <detect>
            <condition negation="Yes">MigXmlHelper.IsOSEarlierThan("NT","6.0.0.0")</condition>
          </detect>
        </detects>

        <include>
          <objectSet>
            <!-- Eventlog machine specific settings (owner:MichaelM)-->
            <pattern type="File">%WINDIR%\system32\winevt\logs [*]</pattern>
            <pattern type="File">%WINDIR%\system32\config [*.evt]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\* [*]</pattern>
          </objectSet>
        </include>


        <exclude>
          <objectSet>
            <!-- Event log publisher key path -->
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{832d43c6-2e88-4be7-a4d1-61fc2430ff07}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{d6795c62-6f24-4363-99ce-2ff3f4b1faba}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{f863cf1c-c759-4dc0-98bb-81a109974cdf}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{fb5e81f8-9a5c-4c9e-8144-6b9123e078df}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{d2dd58ba-3ed4-4d5a-9987-af473bb6d0b0}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{1be39648-5678-4fae-839b-10da2c4cf234}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{cd75048f-1233-4f58-b9ed-98ba2097ac7e}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{4153360c-6259-4e56-900c-818532b7897d}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{5b33145c-1c66-49f3-b4ca-f563c165f2c0}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{13e8b4f7-4d1c-4f65-95a2-39c6b26a3012}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{986329a0-a1d5-46cf-8801-595d646c271f}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{1fd7c1d2-d037-4620-8d29-b2c7e5fcc13a}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{560b2594-7530-4c77-8998-f067ae1e2918}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{a58d520f-c444-4982-bb61-8db7f0a5f217}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{4d5ae6a1-c7c8-4e6d-b840-4d8080b42e1b}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{eea178e3-e9d4-41ca-bb56-cede1a476629}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{4b3efc0a-e514-4022-bd50-532620d2d9fb}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{67beaf60-484b-4078-a99b-95cf827c553b}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{2129b945-09ed-4965-820e-032243a31578}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{e4c60dfa-ecc5-4889-b406-e9ddd38463c8}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{565bbeca-5b04-49bb-81c6-3e21527fcc8a}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{e98754d0-883b-11db-b606-0800200c9a66}\* [*]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{95353826-4fbe-41d4-9c42-f521c6e86360}\* [*]</pattern>
            
            <!-- Event log channel key path -->
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\Microsoft-Windows-MeetingSpace/Operational [*]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\Microsoft-Windows-Security-Licensing-SLC/Perf [*]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\Microsoft-Windows-TerminalServices-Gateway/* [*]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\Microsoft-Windows-Diagnosis-MSDT* [*]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\Microsoft-Windows-PrintSpooler* [*]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\Microsoft-Windows-Eventlog-ForwardPlugin/Debug [*]</pattern>            
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\Microsoft-Windows-OfflineFiles* [*]</pattern>
          </objectSet>
        </exclude>

        <includeAttributes attributes="Security">
          <objectSet>
            <pattern type="File">%WINDIR%\system32\winevt\logs [Microsoft-Windows-TerminalServices-PnPDevices%4Analytic.etl]</pattern>
          </objectSet>
        </includeAttributes>

        <merge script="MigXmlHelper.DestinationPriority()">
          <objectSet>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\* [*]</pattern>

            <!-- Svchost settings -->
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog [*]</pattern>
          </objectSet>
        </merge>

        <merge script="MigXmlHelper.SourcePriority()">
          <objectSet>
            <!-- Event log files and paths -->
            <pattern type="File">%WINDIR%\system32\winevt\logs [*]</pattern>
            <pattern type="File">%WINDIR%\system32\config [*.evt]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [File]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [File]</pattern>

            <!-- Eventlog global settings -->
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt [*]</pattern>

            <!-- Event log settings -->
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [Enabled]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [ChannelAccess]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [Retention]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [AutoBackupLogFiles]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [BufferSize]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [MinBuffers]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [MaxBuffers]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [Latency]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [ClockType]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [SidType]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [Level]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [KeywordsLower]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [KeywordsUpper]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [FileMax]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [FileCounter]</pattern>
            <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\filters\* [*]</pattern>

            <!-- Classic event log settings -->
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [CustomSD]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [Isolation]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [Flags]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [Retention]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [AutoBackupLogFiles]</pattern>
          </objectSet>
        </merge>

        <merge script="MigXmlHelper.HigherValue()">
          <objectSet>
             <!-- Event log size -->
             <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [MaxSize]</pattern>
             <pattern type="Registry">HKLM\Software\Microsoft\Windows\CurrentVersion\winevt\channels\$ [MaxSizeUpper]</pattern>
             <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [MaxSize]</pattern>
             <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\$ [MaxSizeUpper]</pattern>
          </objectSet>
        </merge>
      </rules>

      <rules context="System">
        <include>
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\partmgr\Parameters [SanPolicy]</pattern>
              <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\mountmgr [NoAutoMount]</pattern>
          </objectSet>
        </include>
      </rules>

      <rules context="System">
        <conditions>
          <condition negation="Yes">MigXmlHelper.DoesObjectExist("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\partmgr\Parameters [SanPolicy]")</condition>
        </conditions>
        <contentModify script="MigXmlHelper.SetValueByTable('0,1', '1,2', '1')">
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\mountmgr [NoAutoMount]</pattern>
          </objectSet>
        </contentModify>
        <locationModify script="MigXmlHelper.ExactMove('HKLM\SYSTEM\CurrentControlSet\Services\partmgr\Parameters [SanPolicy]')">
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\mountmgr [NoAutoMount]</pattern>
          </objectSet>
        </locationModify>
      </rules>
        
    </role>
  </component>

  <component type="System" context="System">
    <displayName>DCRoleOfflineUpgrade</displayName>
    <paths>
      <path type="File">%WINDIR%\DCRoleOfflineUpgrade</path>
    </paths>

    <role role="Settings">
      <detects>
        <detect context="System">
          <condition>MigXmlHelper.DoesStringContentEqual("Registry", "HKLM\SYSTEM\CurrentControlSet\control\ProductOptions [ProductType]", "LanManNT")</condition>
        </detect>
      </detects>

      <environment context="System">
        <variable name="DSA_WORKING_DIR">
          <script>MigXmlHelper.GetStringContent("Registry","HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [DSA Working Directory]")</script>
        </variable>
        <variable name="DATABASE_LOG_FILES_PATH">
          <script>MigXmlHelper.GetStringContent("Registry","HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [Database log files path]")</script>
        </variable>
      </environment>

      <rules context="System">
        <addObjects>
          <object>
            <location type="Registry">HKLM\System\CurrentControlSet\Services\NTDS [Start]</location>
            <attributes>Dword</attributes>
            <bytes>02000000</bytes>
          </object>
        </addObjects>

        <include>
          <objectSet>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Diagnostics\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\NTDS\rid\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\NTDS\RID Values\* [*]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\control\ProductOptions [ProductType]</pattern>
            <pattern type="Registry">HKLM\SYSTEM\CurrentControlSet\Services\NetLogon\Parameters [SysVol]</pattern>
            <pattern type="Registry">HKLM\SOFTWARE\Microsoft\NTDS\* [*]</pattern>
            <pattern type="Registry">HKLM\System\CurrentControlSet\Services\NTDS [Start]</pattern>
          </objectSet>
        </include>

      </rules>
      <rules context="System">
        <detects>
          <detect>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [DSA Working Directory]","%SystemRoot%")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [DSA Working Directory]","%ProgramFiles%")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [DSA Working Directory]","%SystemDrive%\Program Files")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [DSA Working Directory]","%ProgramFiles(x86)%")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [DSA Working Directory]","%SystemDrive%\build")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [DSA Working Directory]","%SystemDrive%\InstalledRepository")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [DSA Working Directory]","%ProfilesFolder%")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [DSA Working Directory]","%ProgramData%")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [DSA Working Directory]","%SystemDrive%\Documents and Settings")</condition>
          </detect>
        </detects>
        <include>
          <objectSet>
            <pattern type="File">%DSA_WORKING_DIR%\* [*]</pattern>
          </objectSet>
        </include>
      </rules>

      <rules context="System">
        <detects>
          <detect>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [Database log files path]","%SystemRoot%")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [Database log files path]","%ProgramFiles%")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [Database log files path]","%SystemDrive%\Program Files")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [Database log files path]","%ProgramFiles(x86)%")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [Database log files path]","%SystemDrive%\build")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [Database log files path]","%SystemDrive%\InstalledRepository")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [Database log files path]","%ProfilesFolder%")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [Database log files path]","%ProgramData%")</condition>
            <condition>MigXmlHelper.DoesStringContentContain("Registry", "HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters [Database log files path]","%SystemDrive%\Documents and Settings")</condition>
          </detect>
        </detects>
        <include>
          <objectSet>
            <pattern type="File">%DATABASE_LOG_FILES_PATH%\* [*]</pattern>
          </objectSet>
        </include>
      </rules>

    </role>
  </component>

</migration>
