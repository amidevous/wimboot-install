#!ipxe
set menu-timeout 30000
#set menu-timeout 1
set nloc ${netX/busloc}
set pciid ${pci/${nloc}.0.2}${pci/${nloc}.2.2}
set submenu-timeout ${menu-timeout}
isset ${menu-default} || set menu-default item1

menu
item --gap --           -----------------------------------------
item item1            	                Return
item --gap --           -----------------------------------------
item item2      	windows 7 Starter 32 bit Legacy Francais ${pciid}
#item item3      	windows 7 Starter 32 bit Legacy Francais
#item item4		windows 7 Home Basic 32 bit Legacy English
#item item5		windows 7 Home Basic 64 bit Legacy English
#item item6		netboot
item shell              Shell iPXE
item exit              	Exit

choose --timeout ${menu-timeout} --default ${menu-default} target && goto ${target}

:item1
chain http://${server_ip}/win7/x86/ipxe/menu.ipxe

:item2
imgfree
kernel https://github.com/ipxe/wimboot/releases/latest/download/wimboot.i386 gui quiet                                                           || shell
#kernel https://github.com/ipxe/wimboot/releases/latest/download/wimboot.i386

set startnetx

initrd http://${server_ip}/win10/french/boot/bcd bcd
initrd http://${server_ip}/win10/french/boot/boot.sdi boot.sdi
initrd http://${server_ip}/win7/x86/autounattend/x86/starter/french/legacy/install.bat install.bat
initrd http://${server_ip}/WinPE_x86/winpeshl.ini winpeshl.ini
# E1D68
# TODO 0d4f only installing drivers in winpe, not when getting into windows.
# 15fc on T15 not working in winpe either
# TODO also fix ipxe sources and test
iseq ${pciid} 80860d4f && goto use_e1d68 ||
iseq ${pciid} 808615fc && goto use_e1d68 ||
iseq ${pciid} 808615bb && goto use_e1d68 ||
iseq ${pciid} 808615be && goto use_e1d68 ||
goto skip_e1d68
:use_e1d68
set startnetx ${startnetx}&drvload=e1d68x64.inf
initrd     http://${server_ip}/win10/drv/i219v_e1d68/e1d68x64.cat ||
initrd     http://${server_ip}/win10/drv/i219v_e1d68/e1d68x64.inf ||
initrd     http://${server_ip}/win10/drv/i219v_e1d68/e1d68x64.sys ||
initrd     http://${server_ip}/win10/drv/i219v_e1d68/e1dmsg.dll ||
:skip_e1d68
iseq ${pciid} 1af41000 && goto use_virtio ||
goto skip_virtio
:use_virtio
# without extra name wimboot crashes (in pcbios mode)
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/Balloon/w10/x86/virtio/balloon.cat   balloon.cat ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/Balloon/w10/x86/balloon.inf   balloon.inf ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/Balloon/w10/x86/balloon.sys   balloon.sys ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/Balloon/w10/x86/blnsvr.exe blnsvr.exe ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/NetKVM/w10/x86/netkvm.cat   netkvm.cat ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/NetKVM/w10/x86/netkvm.inf   netkvm.inf ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/NetKVM/w10/x86/netkvm.sys   netkvm.sys ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/NetKVM/w10/x86/netkvmco.dll netkvmco.dll ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/vioscsi/w10/x86/vioscsi.cat  vioscsi.cat ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/vioscsi/w10/x86/vioscsi.inf  vioscsi.inf ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/vioscsi/w10/x86/vioscsi.sys  vioscsi.sys ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/viostor/w10/x86/viostor.cat  viostor.cat ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/viostor/w10/x86/viostor.inf  viostor.inf ||
initrd     http://${server_ip}/win10/drv/virtio-win-0.1.240/viostor/w10/x86/viostor.sys  viostor.sys ||
goto skip_virtio
:skip_virtio
iseq ${pciid} 8086100e && goto use_vbox ||
goto skip_vbox
:use_vbox
initrd http://${server_ip}/win10/drv/vbox/VBoxGuest.inf VBoxGuest.inf
initrd http://${server_ip}/win10/drv/vbox/VBoxGuest.cat VBoxGuest.cat
initrd http://${server_ip}/win10/drv/vbox/VBoxGuest.sys VBoxGuest.sys
initrd http://${server_ip}/win10/drv/vbox/VBoxGuestEarlyNT.cat VBoxGuestEarlyNT.cat
initrd http://${server_ip}/win10/drv/vbox/VBoxGuestEarlyNT.inf VBoxGuestEarlyNT.inf
initrd http://${server_ip}/win10/drv/vbox/VBoxMouse.cat VBoxMouse.cat
initrd http://${server_ip}/win10/drv/vbox/VBoxMouse.inf VBoxMouse.inf
initrd http://${server_ip}/win10/drv/vbox/VBoxMouse.sys VBoxMouse.sys
initrd http://${server_ip}/win10/drv/vbox/VBoxVideo.cat VBoxVideo.cat
initrd http://${server_ip}/win10/drv/vbox/VBoxVideo.inf VBoxVideo.inf
initrd http://${server_ip}/win10/drv/vbox/VBoxVideo.sys VBoxVideo.sys
initrd http://${server_ip}/win10/drv/vbox/VBoxVideoEarlyNT.cat VBoxVideoEarlyNT.cat
initrd http://${server_ip}/win10/drv/vbox/VBoxVideoEarlyNT.inf VBoxVideoEarlyNT.inf
initrd http://${server_ip}/win10/drv/vbox/VBoxWddm.cat VBoxWddm.cat
initrd http://${server_ip}/win10/drv/vbox/VBoxWddm.inf VBoxWddm.inf
initrd http://${server_ip}/win10/drv/vbox/VBoxWddm.sys VBoxWddm.sys
initrd http://${server_ip}/win10/drv/vbox/vboxguest.cat vboxguest.cat
initrd http://${server_ip}/win10/drv/vbox/vboxmouse.cat vboxmouse.cat
initrd http://${server_ip}/win10/drv/vbox/vboxwddm.cat vboxwddm.cat
goto skip_vbox
:skip_vbox
initrd http://62.210.202.52/win7/x86/autounattend/x86/starter/french/legacy/autounattend.xml autounattend.xml
initrd http://${server_ip}/win10/french/sources/boot.wim boot.wim
boot || goto menu

:item3
kernel https://github.com/ipxe/wimboot/releases/latest/download/wimboot.i386
initrd http://${server_ip}/win10/french/boot/bcd bcd
initrd http://${server_ip}/win10/french/boot/boot.sdi boot.sdi
initrd http://${server_ip}/win7/x86/autounattend/x86/starter/french/legacy/install.bat install.bat
initrd http://${server_ip}/WinPE_x86/winpeshl.ini winpeshl.ini
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuest.inf VBoxGuest.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuest.cat VBoxGuest.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuest.sys VBoxGuest.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuestEarlyNT.cat VBoxGuestEarlyNT.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuestEarlyNT.inf VBoxGuestEarlyNT.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxMouse.cat VBoxMouse.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxMouse.inf VBoxMouse.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxMouse.sys VBoxMouse.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideo.cat VBoxVideo.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideo.inf VBoxVideo.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideo.sys VBoxVideo.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideoEarlyNT.cat VBoxVideoEarlyNT.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideoEarlyNT.inf VBoxVideoEarlyNT.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxWddm.cat VBoxWddm.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxWddm.inf VBoxWddm.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxWddm.sys VBoxWddm.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/vboxguest.cat vboxguest.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/vboxmouse.cat vboxmouse.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/vboxwddm.cat vboxwddm.cat
initrd http://62.210.202.52/win7/x86/autounattend/x86/starter/french/legacy/autounattend.xml autounattend.xml
initrd http://${server_ip}/win10/french/sources/boot.wim boot.wim
boot || goto menu


:item4
kernel https://github.com/ipxe/wimboot/releases/latest/download/wimboot.i386
initrd http://${server_ip}/win10/french/boot/bcd bcd
initrd http://${server_ip}/win10/french/boot/boot.sdi boot.sdi
initrd http://${server_ip}/win7/x86/autounattend/x86/homebasic/english/legacy/install.bat install.bat
initrd http://${server_ip}/WinPE_x86/winpeshl.ini winpeshl.ini
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuest.inf VBoxGuest.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuest.cat VBoxGuest.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuest.sys VBoxGuest.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuestEarlyNT.cat VBoxGuestEarlyNT.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuestEarlyNT.inf VBoxGuestEarlyNT.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxMouse.cat VBoxMouse.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxMouse.inf VBoxMouse.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxMouse.sys VBoxMouse.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideo.cat VBoxVideo.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideo.inf VBoxVideo.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideo.sys VBoxVideo.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideoEarlyNT.cat VBoxVideoEarlyNT.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideoEarlyNT.inf VBoxVideoEarlyNT.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxWddm.cat VBoxWddm.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxWddm.inf VBoxWddm.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxWddm.sys VBoxWddm.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/vboxguest.cat vboxguest.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/vboxmouse.cat vboxmouse.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/vboxwddm.cat vboxwddm.cat
initrd http://${server_ip}/win10/french/sources/boot.wim boot.wim
boot || goto menu


:item5
kernel https://github.com/ipxe/wimboot/releases/latest/download/wimboot.i386
initrd http://${server_ip}/win10/french/boot/bcd bcd
initrd http://${server_ip}/win10/french/boot/boot.sdi boot.sdi
initrd http://${server_ip}/win7/x86/autounattend/x64/homebasic/english/legacy/install.bat install.bat
initrd http://${server_ip}/WinPE_x86/winpeshl.ini winpeshl.ini
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuest.inf VBoxGuest.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuest.cat VBoxGuest.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuest.sys VBoxGuest.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuestEarlyNT.cat VBoxGuestEarlyNT.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxGuestEarlyNT.inf VBoxGuestEarlyNT.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxMouse.cat VBoxMouse.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxMouse.inf VBoxMouse.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxMouse.sys VBoxMouse.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideo.cat VBoxVideo.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideo.inf VBoxVideo.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideo.sys VBoxVideo.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideoEarlyNT.cat VBoxVideoEarlyNT.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxVideoEarlyNT.inf VBoxVideoEarlyNT.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxWddm.cat VBoxWddm.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxWddm.inf VBoxWddm.inf
initrd http://${server_ip}/VBoxWindowsAdditions-x86/VBoxWddm.sys VBoxWddm.sys
initrd http://${server_ip}/VBoxWindowsAdditions-x86/vboxguest.cat vboxguest.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/vboxmouse.cat vboxmouse.cat
initrd http://${server_ip}/VBoxWindowsAdditions-x86/vboxwddm.cat vboxwddm.cat
initrd http://${server_ip}/win10/french/sources/boot.wim boot.wim
boot || goto menu



:item6
ifopen net0
#set net0/ip 10.0.0.3
#set net0/netmask 255.255.255.0
#set net0/gateway 10.0.0.200
#set dns 8.8.8.8
dhcp
set keymap fr
set conn_type https
chain --autofree https://boot.netboot.xyz/ || echo HTTPS failed... attempting HTTP...
set conn_type http
chain --autofree http://boot.netboot.xyz/ || echo HTTP failed, localbooting...
exit


:shell
shell

:exit
exit